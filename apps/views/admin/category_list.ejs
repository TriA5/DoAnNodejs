<%- include('partials/head') %>
<%- include('partials/sidebar') %>

<div class="flex-grow-1 p-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üìÇ Qu·∫£n l√Ω Th·ªÉ lo·∫°i</h2>
        <a href="/admin-ui/categories/create" class="btn btn-primary">+ Th√™m Th·ªÉ lo·∫°i</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 30%">T√™n th·ªÉ lo·∫°i</th>
                        <th>M√¥ t·∫£</th>
                        <th style="width: 15%">H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="cateTableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('user_token');
        
        // 1. Load danh s√°ch
        async function loadCategories() {
            try {
                const res = await fetch('/admin/category', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();

                if (data.status) {
                    const tbody = document.getElementById('cateTableBody');
                    tbody.innerHTML = ''; 

                    data.data.forEach(cat => {
                        const row = `
                            <tr>
                                <td><strong>${cat.Name}</strong></td>
                                <td>${cat.Description || "Kh√¥ng c√≥ m√¥ t·∫£"}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCategory('${cat._id}')">X√≥a</button>
                                </td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                } else {
                    alert(data.message);
                }
            } catch (err) { console.error(err); }
        }

        // 2. X√≥a th·ªÉ lo·∫°i
        async function deleteCategory(id) {
            if(!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a th·ªÉ lo·∫°i n√†y?")) return;

            try {
                const res = await fetch('/admin/category/delete/' + id, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if(data.status) {
                    alert("ƒê√£ x√≥a!");
                    loadCategories(); // Load l·∫°i b·∫£ng
                } else {
                    alert("L·ªói: " + data.message);
                }
            } catch(e) {
                alert("L·ªói k·∫øt n·ªëi!");
            }
        }

        loadCategories();
    </script>

</div>

<%- include('partials/footer') %>