<%- include('partials/head') %>

<%- include('partials/sidebar') %>

<div class="flex-grow-1 p-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>ðŸŽ¥ Danh SÃ¡ch Phim</h2>
        <a href="/admin-ui/movies/create" class="btn btn-primary">+ ThÃªm Phim Má»›i</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>TÃªn phim</th>
                        <th>áº¢nh</th>
                        <th>Thá»ƒ loáº¡i</th>
                        <th>NÄƒm</th>
                        <th>HÃ nh Ä‘á»™ng</th>
                    </tr>
                </thead>
                <tbody id="movieTableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('user_token');
        
        async function loadMovies() {
            try {
                const res = await fetch('/admin/movie', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();

                if (data.status) {
                    const tbody = document.getElementById('movieTableBody');
                    tbody.innerHTML = ''; 

                    data.data.forEach(movie => {
                        let cateName = movie.CategoryInfo?.[0]?.Name || "ChÆ°a phÃ¢n loáº¡i";
                        const row = `
                            <tr>
                                <td>
                                    <strong>${movie.Name}</strong><br>
                                    <small class="text-muted">${movie.OriginName}</small>
                                </td>
                                <td>
                                    <img src="${movie.Thumb}" style="height: 50px; object-fit: cover;">
                                </td>
                                <td><span class="badge bg-info text-dark">${cateName}</span></td>
                                <td>${movie.Year}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMovie('${movie._id}')">XÃ³a</button>
                                </td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                }
            } catch (err) { console.error(err); }
        }

        async function deleteMovie(id) {
            if(!confirm("XÃ³a phim nÃ y?")) return;
            const res = await fetch('/admin/movie/delete/' + id, {
                method: 'DELETE',
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const data = await res.json();
            if(data.status) { loadMovies(); } 
            else { alert(data.message); }
        }

        loadMovies();
    </script>

</div> <%- include('partials/footer') %>